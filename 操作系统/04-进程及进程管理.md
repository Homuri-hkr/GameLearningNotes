### 4.1 进程引入

- 顺序程序：一个程序由若干个程序段组成，这些程序单执行必须是顺序的，就称为顺序程序。

  特点：

  1. 顺序性：严格按照程序所规定的的顺序执行的
  2. 封闭性：程序一旦执行，计算结果不受外界因素干扰
  3. 可再现性：只要给定相同的输入条件，程序重复执行一定会得到相同的结果

- 并发执行：若干程序同时在系统中运行，这些程序在执行时间上是重叠的，一个程序的执行尚未结束，另一个程序执行已经开始

  特点：

  1. 失去程序的封闭性：若一个程序的执行可以改变另一个程序的变量，后者的输出就可能依赖于两个程序执行的相对速度
  2. 程序与计算不再一一对应：程序是指令的有序集合，计算是处理机上的执行过程
  3. 程序并发执行时的相互制约管理

### 4.2 进程概念

- 进程是一个具有一定独立功能跟的程序关于某个数据集合的一次运行活动

- 进程和程序的区别：

  1. 程序是指令的有序集合，其本身没有任何运行的含义。进程是程序在处理机上的一次执行过程
  2. 进程是能独立运行的单位，能与其他进程并行的活动
  3. 进程是竞争计算机系统有限资源的基本单位，也是处理机调度的基本单位

  联系：在支持多任务运行的操作系统中，活动的最小单位是进程，进程一定包含一个程序，因为程序是进程应完成功能的逻辑描述。一个程序可以对应多个进程

- 进程的五状态：

  1. 创建状态：通过一个多个步骤创建进程，如先申请一个空白的PCB，向PCB中填写用于控制和管理进程的信息，为该进程分配所需的资源，然后插入就绪队列中
  2. 就绪状态：进程获得除CPU之外的所有资源，一旦得到CPU控制权就可以立即执行
  3. 运行状态，进程通过进程调度和处理机分派后，得到中央处理机控制权，该进程对应的程序正在处理机运行
  4. 阻塞状态：若一进程正在等待某一事件发生而暂时停止执行
  5. 终止状态：等待操作系统进行善后处理，最后将PCB清零，并将PCB空间返回给系统。当一个进程到达了自然结束点或发生无法克服的错误或被操作系统终结，进入终止状态

- 进程控制块是一个数据结构，是标识进程存在的实体：

  - 进程标识符：每个进程唯一的标识符，用字符或编号表示，在创建一个进程时，由创建者给出进程的标识符
  - 进程的状态：当前进程所处的什么状态，可以使用不同的数字或不同的符号来表示
  - 当前队列指针：该项登记了处于同一状态下的下一个PCB地址，以此将处于同一状态的所有进程勾链起来
  - 进程优先级：反映了进程要求CPU的紧迫程度，通常由用户预先提出或由系统指定
  - CPU现场保护区：当进程由于某种元婴释放处理机时，CPU现场信息被保存在PCB的该区域中，以便在该进程重新获得处理机后继续执行
  - 通信信息：每个进程在与运行过程中与其他进程进行通信时所记录的有关信息
  - 家族联系：有的系统允许一个进程创建自己的子进程，在PCB中必须指明本进程与家族的联系
  - 占有资源清单

### 4.3 进程控制

- 进程管理的功能：进程控制、进程调度、实现进程之间同步协调和通信
- 进程控制负责控制进程状态的变化，核心具有创建进程、撤销进程、进程等待和唤醒功能，通过原语操作来实现控制和管理目的
- 原语：特殊的系统调用，可以完成一个特定的功能，一般为外层软件所调用，其特点是原语执行时不可中断，原语操作具有原子性，不可再分

### 4.4 进程之间的约束关系

- 进程之间的相互制约关系可分为两种情况：一种由于竞争系统资源而引起的间接相互制约关系，一种是由于进程之间存在共享数据而引起的直接相互制约的关系

- 进程同步可细分为：

  - 进程互斥：当某一进程正在访问某一存储区域时，不允许其他进程来读出或修改该存储区的内容，否则就会发生后果无法估计的错误

  - 进程同步：并发进程在一些关键点上可能需要互相等待与互通消息

  - 进程的直接通信

- 临界资源：一次仅允许一个进程使用的资源

  临界区：一组资源共享某一临界资源，这组进程中的每一个进程对应的程序都包含了一个访问该临界资源的程序段

### 4.5 同步机构

- 操作系统提供的同步机构：
  - 锁和上锁、开锁操作：
    1. 检测锁位的值
    2. 若原来值是0，将锁置为1
    3. 若原来值为1，则返回步骤1再考察
    4. 使用完资源后置为0
  - 信号量和PV操作：P操作，取信号灯值减1，若相减结果为负，则调用进程受阻，插入信号灯的等待队列中，否则继续执行。V操作，取信号灯值加1，相加结果大于0，进程继续执行，否则环型在信号灯等待的上一进程。PV操作都是原语操作。实现互斥时初始化为资源可用量，实现同步时是否执行完后拥有了某类资源初始化为0

### 4.7 进程通信

- 进程通信：一个进程与另一个进程共享消息的一种方式，消息是发送进程形成的一个信息块，通过信息的语法表示形成所需传送的内容给接受进程
  1. 消息缓冲通信：接收方和发送方之间有明确的协议，双方都认可其中的消息格式。大多数消息传递机制中都是用消息头，用于标识与消息有关的信息。包括消息缓冲、发送原语和接受原语
  2. 信箱通信：定义信箱结构，消息发送和接受功能包括，提供发送原语和接受原语

### 4.8 线程概念及特点

- 线程：又称轻量级进程，是比进程更小的活动单位
  - 是进程中的一个执行路径。
  - 有自己私用的堆栈和处理机执行环境
  - 共享父进程的主存
  - 是单个进程所创建的许多个同时存在的线程中的一个
- 线程的特点：相对进程而言，线程的创建与管理开销要小得多，因为线程可以共享父进程的所有程序和全局数据，意味着创建一个新线程只涉及最小量的主存分配
- 用户线程：在内核的支持下，在用户层通过线程库实现的，线程库提供对线程创建、调度和管理等方面的支持，用户线程的创建和调度都是在用户空间内进行的，不需要内核干预，能快速的创建和管理。缺点是若内核是单线程的，那么任何一个用户级线程执行了一个线程等待的系统调用就会引起整个系统的阻塞
- 内核线程：由操作系统直接支持，对内核线程的管理是由操作系统完成的，内核在其空间内执行线程创建、调度和管理