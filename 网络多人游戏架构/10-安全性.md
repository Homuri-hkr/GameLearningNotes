### 10.1 数据包嗅探

- 正常网络操作中，数据包通过路径上从源到目的IP地址的几个不同计算机进行路由，沿途的路由器至少需要读取数据包的头部信息，以便确定将数据包发送到哪里，有时头部地址由于网络地址转换可能被重写，但由于被传输数据的开放本质，路由过程中的任何一台机器都可以检查一个特定数据包中的所有数据
- 有时检查数据包中包含的负载是正常的网络操作，如为了实现服务质量采用深度包检测，服务质量系统需要读取数据包来确定其包含什么内容，若一个数据包被确定为包含对等网络的文件共享数据，则会被服务比包含用于IP呼叫数据的数据包更低的优先级
- 数据包嗅探：以非正常网络操作的目的读取数据包数据。如偷取登录信息，在网络游戏中作弊等

#### 10.1.1 中间人攻击

- 中间人攻击中，从源点到目的地的路由过程中某台计算机在嗅探数据包，而不知道源主机和目的主机的信息。任何不安全的或公共无线网络的计算机都可能被该网络中的另一台计算机读取数据包信息。在有线网络上可能是网关计算机在嗅探数据包
- 打击中间人的常用方法是加密所有传输的数据，网络游戏在实施任何形式的加密系统之前，应该考虑所讨论的游戏是否包含需要加密的敏感数据，如金钱交易等，若传输的数据只是赋值数据，则中间人拦截此数据是无关紧要的
- 公钥加密算法，一种适合传输安全信息的加密算法，通过在不同机器上设置不同的公钥和私钥，私钥只对其生产者开放，不能和任何人分享。当两台机器首次握手成功，它们交换公钥，当A给B发送消息时将使用B的公钥加密该信息，只有通过B的私钥才能解密该信息
- 当今最流行的公钥加密系统是RSA系统，其中公钥是基于非常大的半素数（两个素数的乘积），私钥是基于该半素数的素数因数分解，该系统可行的原因是对于整数分解没有多项式时间的算法，且几乎不能暴力分解一个1024位或2048位的两个大素数之积。注意流行代表着若被破解了很多基于RSA或类似的系统都将gg

#### 10.1.2 在主机上的数据包嗅探

- 虽然只有传输敏感数据的游戏需要担心中间人攻击，但每个网络游戏都容易受到故意嗅探数据包的主机的影响，该情况下加密数据是一种威慑但不是万无一失的措施。任何平台上的可执行文件都可以被破解，可执行文件中一定有某段程序知道如何解密其收到的数据
- 逆向编写解密代码并找到存储在客户端的私钥需要一定时间，让潜在作弊者作弊起来更困难的一种方法仍然是加密数据，且定期改变密钥及其内存偏移，会让部分解密者知难而退
- 主机上玩家一般试图利用信息作弊，意味着其正在收集不应该知道的信息，防止这种作弊方法是限制发送到每个主机的信息量，一般情况下应假设发送给每个主机的数据都可以被视图作弊的玩家检查，若游戏只保证发送与每个主机相关的重要信息，那么将最小化作弊的可能，其在客户端服务器拓扑上比对等网络上更容易实现，因为对等网络中与游戏相关的所有数据都被发送给每个对等体

### 10.2 输入验证

- 输入验证努力保证所有玩家执行的动作是有效的，其同时适用于客户端-服务器和对等网络拓扑游戏
- 输入验证的实现归结为简单的前提，即游戏不应该盲目的执行来自网络数据包中的操作，应先验证操作以保证在所讨论的时间点操作是有效的。在收到玩家操作时，确认玩家是否有进行该操作的前提，然后证明是否是由该玩家的客户端发出的。当服务器收到玩家的无效操作时，可能是由于网络延迟或数据包丢失引起的，所以直接拒绝比直接踢出玩家更合理
- 虽然输入验证用于服务器验证客户端以及一个对等体验证另一个对等体都是有效的，但客户端验证服务器的命令是比较困难的，对于运行在开发者托管的服务器上游戏这不是问题，但对于运行在玩家托管的服务器上的游戏将是一个物体
- 在权威服务器模型中，只有服务器拥有游戏状态的完整信息，所以当一个服务器发送一个信息时，客户端很难验证该信息是否正确，且在典型配置中，客户端不能和其他客户端直接交流
- 解决来自服务器坏数据问题的最简单也是唯一的单圈方法是不让玩家主持游戏，随着云托管的出现，甚至低预算的游戏使用云托管服务器都是可行的，虽然仍存在成本但基本上比在数据中心运行物理服务器花费要少。若没有这方面的预算，或只想让玩家运行自己的服务器，解决方法就会很复杂。一种成功概率不高的方法是客户端之间保持对等网络连接，这将增加代码复杂度和运行带宽的要求，但可以对服务器的信息进行一些验证。但这并非总是有效的，客户端能到达服务器并不意味着客户端之间能彼此到达，当涉及NAT穿越、防火墙更是如此。即使客户端都能彼此可达，也不能保证对等网络数据包比来自服务器的数据包先到达，这意味着客户端不得不等待另一个客户端的数据包，延迟游戏状态更新，或完全接受服务器的信息

### 10.3 软件作弊检测

- 软件作弊检测中，作为游戏进程的一部分或者游戏进程外的软件主动监测游戏的完整性，作弊的大多数方法都会在游戏的那台机器上运行作弊软件，一些作弊软件嵌入到游戏进程中，其他一些作弊软件会重写游戏进程的内存，还有些用于自动化第三方应用程序，甚至有些会修改游戏使用的数据文件，所有这些不同类型的作弊都可以通过使用软件作弊检测发现，该方法是打击作弊最有效的方法
- 一些作弊方法：
  - 地图黑客：通过编写作弊程序删除战争迷雾，使别人看不见的区域自己能看见
  - 机器人外挂：扮演成玩家玩游戏或以某种方式辅助玩家

#### 10.3.1 维尔福反作弊系统

- 维尔福反作弊系统（VAC）是一个软件作弊检测平台，适用于使用Seamworks游戏开发平台的游戏。其为每个游戏维护了一个被禁用户列表，当一个被禁的用户尝试连接了使用VAC的服务器，则用户被拒绝访问服务器，一些游戏甚至会跨多个游戏进行禁止
- VAC通过扫描已知的作弊程序检测运行时作弊，可能使用几种方法来检测一个作弊程序，但至少有一种方法是扫描游戏进程的内存。若一个用户被检测到使用作弊程序，通常不会被立即禁止，其很先让的表明作弊不能再被安全使用了，所以只是简单的创建一个再未来某一时刻被禁止的用户列表，使得系统能抓到更多的使用作弊的玩家，并一次性禁止他们
- 有个在Valve的Source引擎中实现的相关功能，称为纯服务器， 仅仅用于使用Source引擎的游戏，一台纯服务器验证用户在连接时的内容。服务器已经预知客户端上存在的所有文件的检验和，加入游戏时，客户端必须给服务器发送它的文件检验和，若存在不匹配则客户端被踢掉，该过程也会发生在关卡变换以及地图转换时。若有些游戏可以定制部分内容，则需要有一个白名单，其中不会进行扫描

#### 10.3.2 典狱长反作弊系统

- 典狱长反作弊系统（Warden）是暴雪创建的程序，用在他们所有的游戏上，其通过扫描计算机的内存来检测已知的作弊程序，若检测到作弊，该信息发送回反作弊系统的服务器，该用户会在未来的某个时间点被禁止
- Warden强大的烦恼歌面是在游戏运行时可以更新功能，其提供了一个重要的战术优势，在新的游戏补丁发布时不会马上使用作弊程序，此时作弊程序可能不工作或即使工作也几乎肯定被发现，所以当Warden动态更新时，可能会抓到某些没有意识到更新的用户

### 10.4 保护服务器

- 网络游戏安全另一个方面是保护服务器不被攻击，其对于任何有中心服务器的共享世界游戏尤其重要

#### 10.4.1 分布式拒绝服务攻击

- 分布式拒绝服务攻击（DDoS）目的是让服务器不能成功的完成请求，最终导致服务器不可到达或者对于合法用户不可用。其使用太多的输入数据让服务器的网络连接饱和了，或耗尽了太多的处理能力，以至于服务器不能跟上实际的需求
- 若使用自己的硬件作为游戏服务器，则避免DDoS攻击是困难和有压力的，其设计与ISP密切合作，潜在的硬件升级和不同服务器之间分配流量。若服务器使用云托管方案，一些防止DDoS攻击的工作课可以交给云提供商。但谨慎期间仍要在准备和测试不同的预防战略上投入时间

#### 10.4.2 坏数据

- 恶意用户可能会尝试给服务器发送格式不正确或不合适的数据包，可能原因是用户试图让服务器崩溃，或通过数据包缓冲区溢出及类似攻击让服务器执行恶意代码
- 最好的解决方法是模糊测试的一种自动测试方法。一般情况下其用户发现代码中正常单位测试或质量保证测试不可能发现的错误。对于网络游戏可以用模糊测试给服务器发送大量的非结构化数据，看这样的数据是否会让服务器崩溃，并修复这一过程中发现的任何错误。为找到更多错误可以同时使用充分随机化的数据和更加结构化的数据。这样可以最小化游戏受到坏数据影响的可能性

#### 10.4.3 时序攻击

- 任何将期望的字节签名或哈希与受到的签名比较的代码都容易受到时序攻击
- 时序攻击通过分析特定哈希算法或加密系统已经拒绝无效数据所花费的时间，可以了解到其实现的信息。如简单的一个字符数组元素的比较，在比较到不同时就返回false，通过返回时间的长短，用户就可以尝试使用不同的数据就最终确定完整的元素。解决方案是让不管错误与否，其执行时间都是相同的

#### 10.4.4 入侵

- 服务器安全的一个大问题是恶意用户试图闯入服务器，尤其是对于共享世界的游戏，目的可能是窃取用户数据、信用卡号和密码、毁掉游戏的整个数据库从而删除整个游戏的数据
- 预防措施是确保服务器上的所有软件都是最新的，包括操作系统上的一切、数据库、用于自动化的任何软件、网络应用程序等。旧版本的可能包含新版本已经修复的漏洞
- 鱼叉式钓鱼攻击，首先闯入有权访问中央服务器的个人机器，然后以个人机器为跳板进入服务器系统。因此最低限度，在所有开发人员机器上的操作系统以及访问Internet或网络的任何软件都应始终保持更新。另一个方法是限制个人机器访问关键服务器和数据机器的方式
- 一些防范措施：
  - 要确保存储在服务器上的任何敏感数据尽可能安全，即使在被攻击的情况下仍可以保证游戏受到的伤害较小，对于敏感数据可以使用适当的哈希算法实现哈希而不是简单的哈希算法
  - 且为防范不安好心的员工，应有一个全面的日志和审计制度
  - 定期备份重要的数据到线下的物理设备上